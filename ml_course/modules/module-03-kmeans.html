<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 03: K-Means Clustering | ML Intuition</title>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-main: #0f172a;
            --accent-purple: #8b5cf6;
            --dark-slate: #1e293b;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; color: var(--text-main); line-height: 1.6; }
        header { background: var(--dark-slate); color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; }
        .nav-btn { background: rgba(255,255,255,0.1); color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; text-decoration: none; }
        .container { max-width: 1000px; margin: 0 auto; padding: 2rem; }
        
        .dashboard {
            background: #f1f5f9;
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        canvas {
            background: white;
            border-radius: 8px;
            width: 100%;
            height: 400px;
            box-shadow: inset 0 2px 4px 0 rgb(0 0 0 / 0.05);
        }

        .btn { padding: 0.6rem 1.2rem; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; transition: opacity 0.2s; }
        .btn-primary { background: var(--accent-purple); color: white; }
        .btn-secondary { background: var(--dark-slate); color: white; }

        #toast { position: fixed; bottom: 2rem; right: 2rem; background: var(--dark-slate); color: white; padding: 1rem 1.5rem; border-radius: 8px; transform: translateY(200%); transition: transform 0.3s; }
        #toast.show { transform: translateY(0); }
    </style>
</head>
<body>
    <header>
        <div>
            <a href="../index.html" class="nav-btn">‚Üê Hub</a>
            <span style="margin-left: 1rem; font-weight: bold;">Module 03: K-Means Clustering</span>
        </div>
    </header>

    <main class="container">
        <h1>Finding Patterns in Chaos</h1>
        <p>K-Means is an unsupervised algorithm that groups data into <strong>K</strong> clusters by finding central points (centroids).</p>

        <div class="dashboard">
            <div class="controls">
                <label>Clusters (K): <input type="range" id="kSlider" min="2" max="5" value="3"></label>
                <span id="kValue">3</span>
                <button class="btn btn-secondary" onclick="initPoints()">Reset Data</button>
                <button class="btn btn-primary" onclick="stepKMeans()">Step Algorithm</button>
                <button class="btn btn-primary" style="background: #10b981;" onclick="runKMeans()">Run to Convergence</button>
            </div>
            <canvas id="kmeansCanvas"></canvas>
        </div>

        <section style="margin-top: 3rem;">
            <h3>Checkpoint</h3>
            <p>What does 'K' represent in the K-Means algorithm?</p>
            <button class="btn" style="border: 1px solid #ccc; margin-top: 1rem;" onclick="alert('Correct!')">The number of clusters to find</button>
            <button class="btn" style="border: 1px solid #ccc; margin-top: 1rem;" onclick="alert('Try again')">The speed of the algorithm</button>
        </section>

        <div style="margin-top: 4rem; text-align: center;">
            <button id="completionBtn" class="btn btn-primary" style="background: #10b981; padding: 1rem 2rem;">Finish Module</button>
        </div>
    </main>

    <div id="toast">Module Complete!</div>

    <script>
        const canvas = document.getElementById('kmeansCanvas');
        const ctx = canvas.getContext('2d');
        let points = [];
        let centroids = [];
        let k = 3;
        const colors = ['#ef4444', '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6'];

        function initPoints() {
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientHeight;
            points = [];
            for(let i=0; i<100; i++) {
                points.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    cluster: -1
                });
            }
            initCentroids();
            draw();
        }

        function initCentroids() {
            k = parseInt(document.getElementById('kSlider').value);
            centroids = [];
            for(let i=0; i<k; i++) {
                centroids.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    color: colors[i]
                });
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            points.forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, 4, 0, Math.PI*2);
                ctx.fillStyle = p.cluster === -1 ? '#94a3b8' : colors[p.cluster];
                ctx.fill();
            });
            centroids.forEach((c, i) => {
                ctx.fillStyle = colors[i];
                ctx.font = 'bold 24px Arial';
                ctx.fillText('X', c.x - 10, c.y + 10);
            });
        }

        function stepKMeans() {
            // Assign points to nearest centroid
            points.forEach(p => {
                let minDist = Infinity;
                centroids.forEach((c, i) => {
                    let d = Math.hypot(p.x - c.x, p.y - c.y);
                    if (d < minDist) {
                        minDist = d;
                        p.cluster = i;
                    }
                });
            });

            // Move centroids to average of points
            centroids.forEach((c, i) => {
                let clusterPoints = points.filter(p => p.cluster === i);
                if (clusterPoints.length > 0) {
                    c.x = clusterPoints.reduce((sum, p) => sum + p.x, 0) / clusterPoints.length;
                    c.y = clusterPoints.reduce((sum, p) => sum + p.y, 0) / clusterPoints.length;
                }
            });
            draw();
        }

        function runKMeans() {
            for(let i=0; i<10; i++) stepKMeans();
        }

        document.getElementById('kSlider').addEventListener('input', (e) => {
            document.getElementById('kValue').textContent = e.target.value;
            initPoints();
        });

        document.getElementById('completionBtn').addEventListener('click', () => {
            const progress = JSON.parse(localStorage.getItem('ml_course_progress') || '{}');
            progress['module-03'] = true;
            localStorage.setItem('ml_course_progress', JSON.stringify(progress));
            document.getElementById('toast').classList.add('show');
            setTimeout(() => window.location.href = '../index.html', 1500);
        });

        initPoints();
    </script>
</body>
</html>

